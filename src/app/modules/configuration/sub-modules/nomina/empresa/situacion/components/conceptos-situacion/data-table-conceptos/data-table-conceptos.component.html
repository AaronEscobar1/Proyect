<!-- Mensajes de alertas para usuarios -->
<p-toast></p-toast>
<p-confirmDialog ></p-confirmDialog>

<div class="mt-3">
    
    <form #form="ngForm">
        <p-table [value]="conceptoSituacion" [columns]="columns" #dt
                dataKey="idTableTemporal" editMode="row"
                [paginator]="true" [rows]="rows"
                styleClass="p-datatable-scrollable" responsiveLayout="scroll"
                [showCurrentPageReport]="true" currentPageReportTemplate="Mostrando {first} a {last} registros de {totalRecords} entradas." [rowsPerPageOptions]="[5, 10, 25, 50]" > 

                <ng-template pTemplate="caption">
                    <div class="grid flex-row-reverse">
                        <div class="col-12 md:col-4 lg:col-3">
                            <button pButton
                                    label="Agregar fila" 
                                    class="p-button-secondary"
                                    (click)="addNewRow()"
                                    [disabled]="isEdit || isAddNewRow">
                            </button>
                        </div>
                    </div>
                </ng-template>

                <ng-template pTemplate="header">
                    <tr>
                        <th *ngFor="let col of columns" [pSortableColumn]="col.field" class="text-center">
                            {{ col.header }}
                            <p-sortIcon [field]="col.field"></p-sortIcon>
                        </th>
                        <th style="width:8rem"></th>
                    </tr>
                    <tr>
                        <th *ngFor="let col of columns">
                            <p-columnFilter [field]="col.field" matchMode="contains" [showMenu]="false" [showClearButton]="false">
                                <ng-template pTemplate="filter" let-value let-filter="filterCallback">
                                    <input pInputText type="text" (input)="filter($any($event.target).value)" [placeholder]="'Buscar ' + col.header + '...'">
                                </ng-template>
                            </p-columnFilter>
                        </th>
                        <th></th>
                    </tr>
                </ng-template>

                

                <ng-template pTemplate="body" let-conceptoSituacion let-editing="editing" let-index="rowIndex">
                    <tr [pEditableRow]="conceptoSituacion">
                        <td>
                            <p-cellEditor>

                                <ng-template pTemplate="input">
                                    <input pInputText type="text" autocomplete="off"
                                        name="idConcepto" #idConcepto="ngModel" [(ngModel)]="conceptoSituacion.idConcepto"
                                        maxlength="4" required
                                        [disabled]="isEdit">
                                    <div *ngIf="idConcepto.invalid && (idConcepto.dirty || idConcepto.touched)" class="form-text text-danger">
                                        <span *ngIf="idConcepto.errors?.['required']"> 
                                            El código es obligatorio. 
                                        </span>
                                        <div *ngIf="idConcepto.errors?.['maxlength']"> 
                                            El código es de longitud máxima de 4 dígitos. 
                                        </div>
                                    </div>
                                </ng-template>

                                <ng-template pTemplate="output">
                                    {{ conceptoSituacion.idConcepto }}
                                </ng-template>

                            </p-cellEditor>
                        </td>
                        <td class="text-right">
                            <p-cellEditor>

                                <ng-template pTemplate="input">
                                    <input pInputText type="text" autocomplete="off" class="text-right"
                                        name="dialim" #dialim="ngModel" [(ngModel)]="conceptoSituacion.dialim"
                                        maxlength="3" required> <!-- Validaciones -->
                                    <div *ngIf="dialim.invalid && (dialim.dirty || dialim.touched)" class="form-text text-danger">
                                        <span *ngIf="dialim.errors?.['required']">
                                            El día es obligatorio.
                                        </span>
                                        <span *ngIf="dialim.errors?.['maxlength']">
                                            El día es de longitud máxima de 3 dígitos.
                                        </span>
                                    </div>
                                </ng-template>

                                <ng-template pTemplate="output">
                                    {{ conceptoSituacion.dialim }}
                                </ng-template>

                            </p-cellEditor>
                        </td>
                        <td class="text-right">
                            <p-cellEditor>

                                <ng-template pTemplate="input">
                                    <p-dropdown [options]="noSuspender" 
                                                appendTo="body"
                                                name="susvac"
                                                class="w-full"
                                                optionLabel="descripcion"
                                                optionValue="susvac"
                                                [(ngModel)]="conceptoSituacion.nmTipoSuspencionVacacTb.susvac">
                                    </p-dropdown>
                                </ng-template>

                                <ng-template pTemplate="output">
                                    {{ conceptoSituacion.nmTipoSuspencionVacacTb ? conceptoSituacion.nmTipoSuspencionVacacTb.descripcion : '-' }}
                                </ng-template>
                                
                            </p-cellEditor>
                        </td>
                        <td class="text-center">
                            <button *ngIf="!editing" 
                                    pButton
                                    pInitEditableRow 
                                    icon="pi pi-pencil"
                                    class="p-button-rounded p-button-text"
                                    pTooltip="Editar"
                                    tooltipPosition="bottom"
                                    (click)="onRowEditInit(conceptoSituacion)"
                                    [disabled]="isEdit || isAddNewRow">
                            </button>
                            <button *ngIf="!editing" 
                                    pButton
                                    icon="pi pi-trash"
                                    class="p-button-rounded p-button-text"
                                    pTooltip="Eliminar"
                                    tooltipPosition="bottom"
                                    (click)="onRowDelete(conceptoSituacion)"
                                    [disabled]="isEdit || isAddNewRow">
                            </button>
                            <button *ngIf="editing" 
                                    pButton
                                    pSaveEditableRow 
                                    icon="pi pi-save"
                                    class="p-button-rounded p-button-text p-button-success mr-2"
                                    pTooltip="Guardar"
                                    tooltipPosition="bottom"
                                    (click)="onRowEditSave(conceptoSituacion)"
                                    [disabled]="form.invalid">
                            </button>
                            <button *ngIf="editing" 
                                    pButton
                                    pCancelEditableRow 
                                    icon="pi pi-times"
                                    class="p-button-rounded p-button-text p-button-danger"
                                    pTooltip="Cancelar"
                                    tooltipPosition="bottom"
                                    (click)="onRowEditCancel(conceptoSituacion, index)">
                            </button>
                        </td>
                    </tr>
                </ng-template>
                

                <ng-template pTemplate="emptymessage" let-columns>
                    <tr>
                        <td [attr.colspan]="columns.length + 1">
                            <div class="div-center">
                                <div>
                                    <div class="div-round"></div>
                                    <h5 class="no-data-message-1">Sin datos para mostrar</h5>
                                </div>
                            </div>
                        </td>
                    </tr>
                </ng-template>

        </p-table>
    </form>
</div>